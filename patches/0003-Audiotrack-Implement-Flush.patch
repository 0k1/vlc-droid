From a6ea4dec42c3b0735239899bb7d6522c65e41c93 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?S=C3=A9bastien=20Toque?= <xilasz@gmail.com>
Date: Tue, 4 Dec 2012 19:27:50 +0100
Subject: [PATCH 3/3] Audiotrack: Implement Flush

---
 modules/audio_output/audiotrack.c |   10 ++++++++++
 1 files changed, 10 insertions(+), 0 deletions(-)

diff --git a/modules/audio_output/audiotrack.c b/modules/audio_output/audiotrack.c
index bea55ff..9247aa4 100644
--- a/modules/audio_output/audiotrack.c
+++ b/modules/audio_output/audiotrack.c
@@ -122,6 +122,7 @@ static int  Open(vlc_object_t *);
 static void Close(vlc_object_t *);
 static void Play(audio_output_t*, block_t*);
 static void Pause (audio_output_t *, bool, mtime_t);
+static void Flush (audio_output_t *, bool);
 
 vlc_module_begin ()
     set_shortname("AudioTrack")
@@ -277,6 +278,7 @@ static int Start(audio_output_t *aout, audio_sample_format_t *restrict fmt)
     aout->time_get = NULL;
     aout->play = Play;
     aout->pause = Pause;
+    aout->flush = Flush;
 
     p_sys->at_start(p_sys->AudioTrack);
 
@@ -321,6 +323,16 @@ static void Pause(audio_output_t *p_aout, bool pause, mtime_t date)
     }
 }
 
+static void Flush (audio_output_t *p_aout, bool wait)
+{
+    VLC_UNUSED(wait); /* FIXME implement drain */
+    aout_sys_t *p_sys = p_aout->sys;
+
+    p_sys->at_stop(p_sys->AudioTrack);
+    p_sys->at_flush(p_sys->AudioTrack);
+    p_sys->at_start(p_sys->AudioTrack);
+}
+
 static int Open(vlc_object_t *obj)
 {
     audio_output_t *aout = (audio_output_t *)obj;
-- 
1.7.5.4

